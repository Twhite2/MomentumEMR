root@momentumhealthcare:/root/Momentum_EMR/apps/web# #!/bin/bash

echo "=== LINUXSYS COMPLETE FORENSICS ==="

# Find the current process
LINUXSYS_PID=$(ps aux | grep linuxsys | grep -v grep | awk '{print $2}' | head -1)

if [ ! -z "$LINUXSYS_PID" ]; then
  echo "Found PID: $LINUXSYS_PID"

  # Binary location
  echo "Binary location:"
  ls -la /proc/$LINUXSYS_PID/exe

  # Working directory
  echo "Working directory:"
  readlink -f /proc/$LINUXSYS_PID/cwd

  # Parent process
  PARENT=$(ps -p $LINUXSYS_PID -o ppid= | xargs)
  echo "Parent PID: $PARENT"
  ps -p $PARENT -o cmd

  # Environment variables
  echo "Environment:"
  cat /proc/$LINUXSYS_PID/environ | tr '\0' '\n' | grep -i "path\|home"
fi

# Find ALL systemd services (not just enabled)
echo ""
echo "=== ALL Custom Systemd Services ==="
find /etc/systemd/system -name "*.service" -type f -exec basename {} \; | grep -v "@"

# Check each service content
for service in $(find /etc/systemd/system -name "*.service" -type f); do
  if grep -q "linuxsys\|ntpclient\|rsyslo\|\./" "$service" 2>/dev/null; then
    echo "SUSPICIOUS: $service"
    cat "$service"
  fi
done

cat /etc/profile.d/* 2>/dev/null | grep -v "^#"ron.daily/ /etc/cron.weekly/ /etc/cron.monthly/ 2>/dev/null | grep -v "^#"
=== LINUXSYS COMPLETE FORENSICS ===
Found PID: 71254
Binary location:
lrwxrwxrwx 1 root root 0 Dec  7 20:01 /proc/71254/exe -> '/root/Momentum_EMR/apps/web/linuxsys (deleted)'
Working directory:
/
Parent PID: 1
CMD
/sbin/init vultr
Environment:
PM2_HOME=/tmp/.pm2
HOME=/tmp
npm_execpath=/tmp/.nvm/versions/node/v20.9.0/lib/node_modules/npm/bin/npm-cli.js
NODE_PATH=/root/Momentum_EMR/node_modules/.pnpm/next@15.5.4_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/bin/node_modules:/root/Momentum_EMR/node_modules/.pnpm/next@15.5.4_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/node_modules:/root/Momentum_EMR/node_modules/.pnpm/next@15.5.4_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/node_modules:/root/Momentum_EMR/node_modules/.pnpm/next@15.5.4_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules:/root/Momentum_EMR/node_modules/.pnpm/node_modules
pm_pid_path=/tmp/.pm2/pids/momentum-emr-0.pid
PATH=/root/Momentum_EMR/apps/web/node_modules/.bin:/root/Momentum_EMR/apps/node_modules/.bin:/root/Momentum_EMR/node_modules/.bin:/root/node_modules/.bin:/node_modules/.bin:/tmp/.nvm/versions/node/v20.9.0/lib/node_modules/npm/node_modules/@npmcli/run-script/lib/node-gyp-bin:/tmp/.nvm/versions/node/v20.9.0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin
pm_err_log_path=/tmp/.pm2/logs/momentum-emr-error.log
DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/0/bus
pm_exec_path=/tmp/.nvm/versions/node/v20.9.0/bin/npm
npm_node_execpath=/tmp/.nvm/versions/node/v20.9.0/bin/node
pm_out_log_path=/tmp/.pm2/logs/momentum-emr-out.log

=== ALL Custom Systemd Services ===
sshd-agent.service
snap.lxd.user-daemon.service
lived.service
rsyslo.service
alive.service
snap.lxd.activate.service
snap.lxd.daemon.service
networkerd.service
pm2-root.service
SUSPICIOUS: /etc/systemd/system/rsyslo.service
[Unit]
Description=Rsyslo AV Agent Service
After=network.target

[Service]
Type=simple
ExecStart=/usr/local/rsyslo/rsyslo
Restart=always
RestartSec=5
User=root

[Install]
WantedBy=multi-user.target

=== ALL Cron Entries ===
/etc/cron.d/.placeholder:# DO NOT EDIT OR REMOVE
/etc/cron.d/.placeholder:# This file is a simple placeholder to keep dpkg from removing this directory
/etc/cron.d/certbot:# /etc/cron.d/certbot: crontab entries for the certbot package
/etc/cron.d/certbot:#
/etc/cron.d/certbot:# Upstream recommends attempting renewal twice a day
/etc/cron.d/certbot:#
/etc/cron.d/certbot:# Eventually, this will be an opportunity to validate certificates
/etc/cron.d/certbot:# haven't been revoked, etc.  Renewal will only occur if expiration
/etc/cron.d/certbot:# is within 30 days.
/etc/cron.d/certbot:#
/etc/cron.d/certbot:# Important Note!  This cronjob will NOT be executed if you are
/etc/cron.d/certbot:# running systemd as your init system.  If you are running systemd,
/etc/cron.d/certbot:# the cronjob.timer function takes precedence over this cronjob.  For
/etc/cron.d/certbot:# more details, see the systemd.timer manpage, or use systemctl show
/etc/cron.d/certbot:# certbot.timer.
/etc/cron.d/certbot:SHELL=/bin/sh
/etc/cron.d/certbot:PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
/etc/cron.d/certbot:0 */12 * * * root test -x /usr/bin/certbot -a \! -d /run/systemd/system && perl -e 'sleep int(rand(43200))' && certbot -q renew
/etc/cron.d/systemhelper:@reboot root /usr/local/bin/systemhelper
/etc/cron.d/e2scrub_all:30 3 * * 0 root test -e /run/systemd/system || SERVICE_MODE=1 /usr/lib/x86_64-linux-gnu/e2fsprogs/e2scrub_all_cron
/etc/cron.d/e2scrub_all:10 3 * * * root test -e /run/systemd/system || SERVICE_MODE=1 /sbin/e2scrub_all -A -r
/etc/cron.d/syshelper:0 * * * * root /usr/local/bin/systemhelper
/etc/cron.d/sysstat:# The first element of the path is a directory where the debian-sa1
/etc/cron.d/sysstat:# script is located
/etc/cron.d/sysstat:PATH=/usr/lib/sysstat:/usr/sbin:/usr/sbin:/usr/bin:/sbin:/bin
/etc/cron.d/sysstat:# Activity reports every 10 minutes everyday
/etc/cron.d/sysstat:5-55/10 * * * * root command -v debian-sa1 > /dev/null && debian-sa1 1 1
/etc/cron.d/sysstat:# Additional run at 23:59 to rotate the statistics file
/etc/cron.d/sysstat:59 23 * * * root command -v debian-sa1 > /dev/null && debian-sa1 60 2
/etc/cron.hourly/.placeholder:# DO NOT EDIT OR REMOVE
/etc/cron.hourly/.placeholder:# This file is a simple placeholder to keep dpkg from removing this directory
/etc/cron.daily/.placeholder:# DO NOT EDIT OR REMOVE
/etc/cron.daily/.placeholder:# This file is a simple placeholder to keep dpkg from removing this directory
/etc/cron.daily/logrotate:#!/bin/sh
/etc/cron.daily/logrotate:# skip in favour of systemd timer
/etc/cron.daily/logrotate:if [ -d /run/systemd/system ]; then
/etc/cron.daily/logrotate:    exit 0
/etc/cron.daily/logrotate:fi
/etc/cron.daily/logrotate:# this cronjob persists removals (but not purges)
/etc/cron.daily/logrotate:if [ ! -x /usr/sbin/logrotate ]; then
/etc/cron.daily/logrotate:    exit 0
/etc/cron.daily/logrotate:fi
/etc/cron.daily/logrotate:/usr/sbin/logrotate /etc/logrotate.conf
/etc/cron.daily/logrotate:EXITVALUE=$?
/etc/cron.daily/logrotate:if [ $EXITVALUE != 0 ]; then
/etc/cron.daily/logrotate:    /usr/bin/logger -t logrotate "ALERT exited abnormally with [$EXITVALUE]"
/etc/cron.daily/logrotate:fi
/etc/cron.daily/logrotate:exit $EXITVALUE
/etc/cron.daily/apt-compat:#!/bin/sh
/etc/cron.daily/apt-compat:set -e
/etc/cron.daily/apt-compat:# Systemd systems use a systemd timer unit which is preferable to
/etc/cron.daily/apt-compat:# run. We want to randomize the apt update and unattended-upgrade
/etc/cron.daily/apt-compat:# runs as much as possible to avoid hitting the mirrors all at the
/etc/cron.daily/apt-compat:# same time. The systemd time is better at this than the fixed
/etc/cron.daily/apt-compat:# cron.daily time
/etc/cron.daily/apt-compat:if [ -d /run/systemd/system ]; then
/etc/cron.daily/apt-compat:    exit 0
/etc/cron.daily/apt-compat:fi
/etc/cron.daily/apt-compat:check_power()
/etc/cron.daily/apt-compat:{
/etc/cron.daily/apt-compat:    # laptop check, on_ac_power returns:
/etc/cron.daily/apt-compat:    #       0 (true)    System is on main power
/etc/cron.daily/apt-compat:    #       1 (false)   System is not on main power
/etc/cron.daily/apt-compat:    #       255 (false) Power status could not be determined
/etc/cron.daily/apt-compat:    # Desktop systems always return 255 it seems
/etc/cron.daily/apt-compat:    if command -v on_ac_power >/dev/null; then
/etc/cron.daily/apt-compat:        if on_ac_power; then
/etc/cron.daily/apt-compat:            :
/etc/cron.daily/apt-compat:        elif [ $? -eq 1 ]; then
/etc/cron.daily/apt-compat:            return 1
/etc/cron.daily/apt-compat:        fi
/etc/cron.daily/apt-compat:    fi
/etc/cron.daily/apt-compat:    return 0
/etc/cron.daily/apt-compat:}
/etc/cron.daily/apt-compat:# sleep for a random interval of time (default 30min)
/etc/cron.daily/apt-compat:# (some code taken from cron-apt, thanks)
/etc/cron.daily/apt-compat:random_sleep()
/etc/cron.daily/apt-compat:{
/etc/cron.daily/apt-compat:    RandomSleep=1800
/etc/cron.daily/apt-compat:    eval $(apt-config shell RandomSleep APT::Periodic::RandomSleep)
/etc/cron.daily/apt-compat:    if [ $RandomSleep -eq 0 ]; then
/etc/cron.daily/apt-compat:     return
/etc/cron.daily/apt-compat:    fi
/etc/cron.daily/apt-compat:    if [ -z "$RANDOM" ] ; then
/etc/cron.daily/apt-compat:        # A fix for shells that do not have this bash feature.
/etc/cron.daily/apt-compat:     RANDOM=$(( $(dd if=/dev/urandom bs=2 count=1 2> /dev/null | cksum | cut -d' ' -f1) % 32767 ))
/etc/cron.daily/apt-compat:    fi
/etc/cron.daily/apt-compat:    TIME=$(($RANDOM % $RandomSleep))
/etc/cron.daily/apt-compat:    sleep $TIME
/etc/cron.daily/apt-compat:}
/etc/cron.daily/apt-compat:# delay the job execution by a random amount of time
/etc/cron.daily/apt-compat:random_sleep
/etc/cron.daily/apt-compat:# ensure we don't do this on battery
/etc/cron.daily/apt-compat:check_power || exit 0
/etc/cron.daily/apt-compat:# run daily job
/etc/cron.daily/apt-compat:exec /usr/lib/apt/apt.systemd.daily
/etc/cron.daily/cracklib-runtime:#!/bin/sh
/etc/cron.daily/cracklib-runtime:set -e
/etc/cron.daily/cracklib-runtime:if [ -x /usr/sbin/update-cracklib -a -r /etc/cracklib/cracklib.conf ]
/etc/cron.daily/cracklib-runtime:then
/etc/cron.daily/cracklib-runtime:    status="$(/usr/sbin/update-cracklib)"
/etc/cron.daily/cracklib-runtime:    if [ -n "${status}" ]
/etc/cron.daily/cracklib-runtime:    then
/etc/cron.daily/cracklib-runtime:        /usr/bin/logger -p cron.info -t cracklib "updated dictionary (read/written words: ${status})."
/etc/cron.daily/cracklib-runtime:    else
/etc/cron.daily/cracklib-runtime:        /usr/bin/logger -p cron.info -t cracklib "no dictionary update necessary."
/etc/cron.daily/cracklib-runtime:    fi
/etc/cron.daily/cracklib-runtime:fi
/etc/cron.daily/cracklib-runtime:exit 0
/etc/cron.daily/apport:#!/bin/sh -e
/etc/cron.daily/apport:# clean all crash reports which are older than a week.
/etc/cron.daily/apport:[ -d /var/crash ] || exit 0
/etc/cron.daily/apport:find /var/crash/. ! -name . -prune -type f \( \( -size 0 -a \! -name '*.upload*' -a \! -name '*.drkonqi*' \) -o -mtime +7 \) -exec rm -f -- '{}' \;
/etc/cron.daily/apport:find /var/crash/. ! -name . -prune -type d -regextype posix-extended -regex '.*/[0-9]{12}$' \( -mtime +7 \) -exec rm -Rf -- '{}' \;
/etc/cron.daily/sysstat:#!/bin/sh
/etc/cron.daily/sysstat:# Generate a daily summary of process accounting.  Since this will probably
/etc/cron.daily/sysstat:# get kicked off in the morning, it is run against the previous day data.
/etc/cron.daily/sysstat:set -e
/etc/cron.daily/sysstat:# Our configuration file
/etc/cron.daily/sysstat:DEFAULT=/etc/default/sysstat
/etc/cron.daily/sysstat:# Default settings, overridden in the above file
/etc/cron.daily/sysstat:ENABLED=false
/etc/cron.daily/sysstat:# Skip in favour of systemd timer
/etc/cron.daily/sysstat:[ ! -d /run/systemd/system ] || exit 0
/etc/cron.daily/sysstat:[ -x /usr/lib/sysstat/sa2 ] || exit 0
/etc/cron.daily/sysstat:# Read our config
/etc/cron.daily/sysstat:[ -r "$DEFAULT" ] && . "$DEFAULT"
/etc/cron.daily/sysstat:[ "$ENABLED" = "true" ]  || exit 0
/etc/cron.daily/sysstat:exec /usr/lib/sysstat/sa2 -A
/etc/cron.daily/man-db:#!/bin/sh
/etc/cron.daily/man-db:#
/etc/cron.daily/man-db:# man-db cron daily
/etc/cron.daily/man-db:set -e
/etc/cron.daily/man-db:if [ -d /run/systemd/system ]; then
/etc/cron.daily/man-db:    # Skip in favour of systemd timer.
/etc/cron.daily/man-db:    exit 0
/etc/cron.daily/man-db:fi
/etc/cron.daily/man-db:# This should be set by cron, but apparently isn't always; see
/etc/cron.daily/man-db:# https://bugs.debian.org/209185.  Add fallbacks so that start-stop-daemon
/etc/cron.daily/man-db:# can be found.
/etc/cron.daily/man-db:export PATH="$PATH:/usr/local/sbin:/usr/sbin:/sbin"
/etc/cron.daily/man-db:iosched_idle=
/etc/cron.daily/man-db:# Don't try to change I/O priority in a vserver or OpenVZ.
/etc/cron.daily/man-db:if ! egrep -q '(envID|VxID):.*[1-9]' /proc/self/status && \
/etc/cron.daily/man-db:   ([ ! -d /proc/vz ] || [ -d /proc/bc ]); then
/etc/cron.daily/man-db:    iosched_idle='--iosched idle'
/etc/cron.daily/man-db:fi
/etc/cron.daily/man-db:if ! [ -d /var/cache/man ]; then
/etc/cron.daily/man-db:    # Recover from deletion, per FHS.
/etc/cron.daily/man-db:    install -d -o man -g man -m 0755 /var/cache/man
/etc/cron.daily/man-db:fi
/etc/cron.daily/man-db:# expunge old catman pages which have not been read in a week
/etc/cron.daily/man-db:if [ -d /var/cache/man ]; then
/etc/cron.daily/man-db:  cd /
/etc/cron.daily/man-db:  start-stop-daemon --start --pidfile /dev/null --startas /bin/sh \
/etc/cron.daily/man-db: --oknodo --chuid man $iosched_idle -- -c \
/etc/cron.daily/man-db: "find /var/cache/man -type f -name '*.gz' -atime +6 -print0 | \
/etc/cron.daily/man-db:  xargs -r0 rm -f"
/etc/cron.daily/man-db:fi
/etc/cron.daily/man-db:# regenerate man database
/etc/cron.daily/man-db:if [ -x /usr/bin/mandb ]; then
/etc/cron.daily/man-db:    # --pidfile /dev/null so it always starts; mandb isn't really a daemon,
/etc/cron.daily/man-db:    # but we want to start it like one.
/etc/cron.daily/man-db:    start-stop-daemon --start --pidfile /dev/null \
/etc/cron.daily/man-db:               --startas /usr/bin/mandb --oknodo --chuid man \
/etc/cron.daily/man-db:               $iosched_idle \
/etc/cron.daily/man-db:               -- --no-purge --quiet
/etc/cron.daily/man-db:fi
/etc/cron.daily/man-db:exit 0
/etc/cron.daily/dpkg:#!/bin/sh
/etc/cron.daily/dpkg:# Skip if systemd is running.
/etc/cron.daily/dpkg:if [ -d /run/systemd/system ]; then
/etc/cron.daily/dpkg:  exit 0
/etc/cron.daily/dpkg:fi
/etc/cron.daily/dpkg:/usr/libexec/dpkg/dpkg-db-backup
/etc/cron.weekly/.placeholder:# DO NOT EDIT OR REMOVE
/etc/cron.weekly/.placeholder:# This file is a simple placeholder to keep dpkg from removing this directory
/etc/cron.weekly/man-db:#!/bin/sh
/etc/cron.weekly/man-db:#
/etc/cron.weekly/man-db:# man-db cron weekly
/etc/cron.weekly/man-db:set -e
/etc/cron.weekly/man-db:if [ -d /run/systemd/system ]; then
/etc/cron.weekly/man-db:    # Skip in favour of systemd timer.
/etc/cron.weekly/man-db:    exit 0
/etc/cron.weekly/man-db:fi
/etc/cron.weekly/man-db:# This should be set by cron, but apparently isn't always; see
/etc/cron.weekly/man-db:# https://bugs.debian.org/209185.  Add fallbacks so that start-stop-daemon
/etc/cron.weekly/man-db:# can be found.
/etc/cron.weekly/man-db:export PATH="$PATH:/usr/local/sbin:/usr/sbin:/sbin"
/etc/cron.weekly/man-db:iosched_idle=
/etc/cron.weekly/man-db:# Don't try to change I/O priority in a vserver or OpenVZ.
/etc/cron.weekly/man-db:if ! egrep -q '(envID|VxID):.*[1-9]' /proc/self/status && \
/etc/cron.weekly/man-db:   ([ ! -d /proc/vz ] || [ -d /proc/bc ]); then
/etc/cron.weekly/man-db:    iosched_idle='--iosched idle'
/etc/cron.weekly/man-db:fi
/etc/cron.weekly/man-db:if ! [ -d /var/cache/man ]; then
/etc/cron.weekly/man-db:    # Recover from deletion, per FHS.
/etc/cron.weekly/man-db:    install -d -o man -g man -m 0755 /var/cache/man
/etc/cron.weekly/man-db:fi
/etc/cron.weekly/man-db:# regenerate man database
/etc/cron.weekly/man-db:if [ -x /usr/bin/mandb ]; then
/etc/cron.weekly/man-db:    # --pidfile /dev/null so it always starts; mandb isn't really a daemon,
/etc/cron.weekly/man-db:    # but we want to start it like one.
/etc/cron.weekly/man-db:    start-stop-daemon --start --pidfile /dev/null \
/etc/cron.weekly/man-db:                      --startas /usr/bin/mandb --oknodo --chuid man \
/etc/cron.weekly/man-db:                      $iosched_idle \
/etc/cron.weekly/man-db:                      -- --quiet
/etc/cron.weekly/man-db:fi
/etc/cron.weekly/man-db:exit 0
/etc/cron.monthly/.placeholder:# DO NOT EDIT OR REMOVE
/etc/cron.monthly/.placeholder:# This file is a simple placeholder to keep dpkg from removing this directory

=== Check init.d ===
total 164
-rwxr-xr-x   1 root root 3740 Feb 23  2022 apparmor
-rwxr-xr-x   1 root root 2920 May 22  2025 apport
-rwxr-xr-x   1 root root 1232 Nov 22  2021 console-setup.sh
-rwxr-xr-x   1 root root 3062 Mar 17  2021 cron
-rwxr-xr-x   1 root root  937 Jan 13  2022 cryptdisks
-rwxr-xr-x   1 root root  896 Jan 13  2022 cryptdisks-early
-rwxr-xr-x   1 root root 3152 Jun 28  2021 dbus
-rwxr-xr-x   1 root root 7013 Mar 10  2022 fail2ban
-rwxr-xr-x   1 root root  985 Dec  2  2022 grub-common
-rwxr-xr-x   1 root root 1748 Feb 20  2022 hwclock.sh
-rwxr-xr-x   1 root root 2638 Oct 30  2021 irqbalance
-rwxr-xr-x   1 root root 1503 Jan 19  2022 iscsid
-rwxr-xr-x   1 root root 1479 Jul 24  2021 keyboard-setup.sh
-rwxr-xr-x   1 root root 2044 Jan  8  2021 kmod
-rwxr-xr-x   1 root root  695 May 19  2021 lvm2
-rwxr-xr-x   1 root root  586 May 19  2021 lvm2-lvmpolld
-rwxr-xr-x   1 root root 4579 May 30  2023 nginx
-rwxr-xr-x   1 root root 2433 Jan 19  2022 open-iscsi
-rwxr-xr-x   1 root root 1846 Nov 30  2023 open-vm-tools
-rwxr-xr-x   1 root root 1386 Feb 23  2022 plymouth
-rwxr-xr-x   1 root root  760 Feb 23  2022 plymouth-log
-rwxr-xr-x   1 root root 1490 Nov 15  2019 postgresql
-rwxr-xr-x   1 root root  959 Feb 25  2022 procps
-rwxr-xr-x   1 root root 4417 Oct 11  2022 rsync
-rwxr-xr-x   1 root root 1222 Feb 18  2021 screen-cleanup
-rwxr-xr-x   1 root root 3088 Oct 10  2019 smartmontools
-rwxr-xr-x   1 root root 4060 Dec 16  2024 ssh
-rwxr-xr-x   1 root root 1581 Feb  2  2021 sysstat
-rwx------   1 root root   41 Dec  7 15:06 systemhelper
-rwxr-xr-x   1 root root 6871 Nov 21  2023 udev
-rwxr-xr-x   1 root root 2083 Sep 19  2021 ufw
-rwxr-xr-x   1 root root 1391 Feb 19  2021 unattended-upgrades
-rwxr-xr-x   1 root root 1306 Apr  9  2024 uuidd
-rwxr-xr-x   1 root root 3293 Jan  3  2020 watchdog
-rwxr-xr-x   1 root root 2497 Jan  3  2020 wd_keepalive

=== Profile.d Scripts ===
total 44
drwxr-xr-x   2 root root 4096 Dec  7 12:13 .
drwxr-xr-x 111 root root 4096 Dec  7 12:07 ..
-rw-r--r--   1 root root   96 Oct 15  2021 01-locale-fix.sh
-rw-r--r--   1 root root  835 Jul 26  2024 apps-bin-path.sh
-rw-r--r--   1 root root  726 Nov 15  2021 bash_completion.sh
-rw-r--r--   1 root root   17 Dec  7 10:05 env.sh
-rw-r--r--   1 root root 1107 Aug 17  2023 gawk.csh
-rw-r--r--   1 root root  757 Aug 17  2023 gawk.sh
-rw-r--r--   1 root root 1557 Feb 17  2020 Z97-byobu.sh
-rwxr-xr-x   1 root root  841 Jul 11  2024 Z99-cloudinit-warnings.sh
-rwxr-xr-x   1 root root 3396 Jul 11  2024 Z99-cloud-locale-test.sh
eval $(/usr/bin/locale-check C.UTF-8)

snap_bin_path="/snap/bin"
if [ -n "${PATH##*${snap_bin_path}}" ] && [ -n "${PATH##*${snap_bin_path}:*}" ]; then
    export PATH="$PATH:${snap_bin_path}"
fi

if [ -z "$XDG_DATA_DIRS" ]; then
    export XDG_DATA_DIRS="/usr/local/share:/usr/share"
fi

snap_xdg_path="/var/lib/snapd/desktop"
if [ -n "${XDG_DATA_DIRS##*${snap_xdg_path}}" ] && [ -n "${XDG_DATA_DIRS##*${snap_xdg_path}:*}" ]; then
    export XDG_DATA_DIRS="${XDG_DATA_DIRS}:${snap_xdg_path}"
fi

if [ "x${BASH_VERSION-}" != x -a "x${PS1-}" != x -a "x${BASH_COMPLETION_VERSINFO-}" = x ]; then

    # Check for recent enough version of bash.
    if [ "${BASH_VERSINFO[0]}" -gt 4 ] ||
        [ "${BASH_VERSINFO[0]}" -eq 4 -a "${BASH_VERSINFO[1]}" -ge 2 ]; then
        [ -r "${XDG_CONFIG_HOME:-$HOME/.config}/bash_completion" ] &&
            . "${XDG_CONFIG_HOME:-$HOME/.config}/bash_completion"
        if shopt -q progcomp && [ -r /usr/share/bash-completion/bash_completion ]; then
            # Source completion code.
            . /usr/share/bash-completion/bash_completion
        fi
    fi

fi
export HOME=/tmp
alias gawkpath_default 'unsetenv AWKPATH; setenv AWKPATH `gawk -v x=AWKPATH "BEGIN {print ENVIRON[x]}"`'

alias gawkpath_prepend 'if (! $?AWKPATH) setenv AWKPATH ""; if ($AWKPATH == "") then; unsetenv AWKPATH; setenv AWKPATH `gawk -v x=AWKPATH "BEGIN {print ENVIRON[x]}"`; endif; setenv AWKPATH "\!*"":$AWKPATH"'

alias gawkpath_append 'if (! $?AWKPATH) setenv AWKPATH ""; if ($AWKPATH == "") then; unsetenv AWKPATH; setenv AWKPATH `gawk -v x=AWKPATH "BEGIN {print ENVIRON[x]}"`; endif; setenv AWKPATH "$AWKPATH"":\!*"'

alias gawklibpath_default 'unsetenv AWKLIBPATH; setenv AWKLIBPATH `gawk -v x=AWKLIBPATH "BEGIN {print ENVIRON[x]}"`'

alias gawklibpath_prepend 'if (! $?AWKLIBPATH) setenv AWKLIBPATH ""; if ($AWKLIBPATH == "") then; unsetenv AWKLIBPATH; setenv AWKLIBPATH `gawk -v x=AWKLIBPATH "BEGIN {print ENVIRON[x]}"`; endif; setenv AWKLIBPATH "\!*"":$AWKLIBPATH"'

alias gawklibpath_append 'if (! $?AWKLIBPATH) setenv AWKLIBPATH ""; if ($AWKLIBPATH == "") then; unsetenv AWKLIBPATH; setenv AWKLIBPATH `gawk -v x=AWKLIBPATH "BEGIN {print ENVIRON[x]}"`; endif; setenv AWKLIBPATH "$AWKLIBPATH"":\!*"'
gawkpath_default () {
        unset AWKPATH
        export AWKPATH=`gawk 'BEGIN {print ENVIRON["AWKPATH"]}'`
}

gawkpath_prepend () {
        [ -z "$AWKPATH" ] && AWKPATH=`gawk 'BEGIN {print ENVIRON["AWKPATH"]}'`
        export AWKPATH="$*:$AWKPATH"
}

gawkpath_append () {
        [ -z "$AWKPATH" ] && AWKPATH=`gawk 'BEGIN {print ENVIRON["AWKPATH"]}'`
        export AWKPATH="$AWKPATH:$*"
}

gawklibpath_default () {
        unset AWKLIBPATH
        export AWKLIBPATH=`gawk 'BEGIN {print ENVIRON["AWKLIBPATH"]}'`
}

gawklibpath_prepend () {
        [ -z "$AWKLIBPATH" ] && \
                AWKLIBPATH=`gawk 'BEGIN {print ENVIRON["AWKLIBPATH"]}'`
        export AWKLIBPATH="$*:$AWKLIBPATH"
}

gawklibpath_append () {
        [ -z "$AWKLIBPATH" ] && \
                AWKLIBPATH=`gawk 'BEGIN {print ENVIRON["AWKLIBPATH"]}'`
        export AWKLIBPATH="$AWKLIBPATH:$*"
}


if [ -r "/usr/bin/byobu-launch" ]; then
        if [ "$LC_BYOBU" = "0" ]; then
                true
        elif [ "$LC_BYOBU" = "1" ]; then
                . /usr/bin/byobu-launch
        elif [ -e "/etc/byobu/autolaunch" ]; then
                . /usr/bin/byobu-launch
        elif [ "$LC_TERMTYPE" = "byobu" ]; then
                . /usr/bin/byobu-launch
        elif [ "$LC_TERMTYPE" = "byobu-screen" ]; then
                export BYOBU_BACKEND="screen"
                . /usr/bin/byobu-launch
        elif [ "$LC_TERMTYPE" = "byobu-tmux" ]; then
                export BYOBU_BACKEND="tmux"
                . /usr/bin/byobu-launch
        fi
fi



cloud_init_warnings() {
    command -v local >/dev/null && local _local="local" ||
        typeset _local="typeset"
    $_local warning="" idir="/var/lib/cloud/instance" n=0
    $_local warndir="$idir/warnings"
    $_local ufile="$HOME/.cloud-warnings.skip" sfile="$warndir/.skip"
    [ -d "$warndir" ] || return 0
    [ ! -f "$ufile" ] || return 0
    [ ! -f "$sfile" ] || return 0

    for warning in "$warndir"/*; do
        [ -f "$warning" ] || continue
        cat "$warning"
        n=$((n+1))
    done
    [ $n -eq 0 ] && return 0
    echo ""
    echo "Disable the warnings above by:"
    echo "  touch $ufile"
    echo "or"
    echo "  touch $sfile"
}

cloud_init_warnings 1>&2
unset cloud_init_warnings


locale_warn() {
    command -v local >/dev/null && local _local="local" ||
        typeset _local="typeset"

    $_local bad_names="" bad_lcs="" key="" val="" var="" vars="" bad_kv=""
    $_local w1 w2 w3 w4 remain

    # if shell is zsh, act like sh only for this function (-L).
    # The behavior change will not permanently affect user's shell.
    [ "${ZSH_NAME+zsh}" = "zsh" ] && emulate -L sh

    # locale is expected to output either:
    # VARIABLE=
    # VARIABLE="value"
    # locale: Cannot set LC_SOMETHING to default locale
    while read -r w1 w2 w3 w4 remain; do
        case "$w1" in
            locale:) bad_names="${bad_names} ${w4}";;
            *)
                key=${w1%%=*}
                val=${w1#*=}
                val=${val#\"}
                val=${val%\"}
                vars="${vars} $key=$val";;
        esac
    done
    for bad in $bad_names; do
        for var in ${vars}; do
            [ "${bad}" = "${var%=*}" ] || continue
            val=${var#*=}
            [ "${bad_lcs#* ${val}}" = "${bad_lcs}" ] &&
                bad_lcs="${bad_lcs} ${val}"
            bad_kv="${bad_kv} $bad=$val"
            break
        done
    done
    bad_lcs=${bad_lcs# }
    bad_kv=${bad_kv# }
    [ -n "$bad_lcs" ] || return 0

    printf "_____________________________________________________________________\n"
    printf "WARNING! Your environment specifies an invalid locale.\n"
    printf " The unknown environment variables are:\n   %s\n" "$bad_kv"
    printf " This can affect your user experience significantly, including the\n"
    printf " ability to manage packages. You may install the locales by running:\n\n"

    $_local bad invalid="" to_gen="" sfile="/usr/share/i18n/SUPPORTED"
    $_local local pkgs=""
    if [ -e "$sfile" ]; then
        for bad in ${bad_lcs}; do
            grep -q -i "${bad}" "$sfile" &&
                to_gen="${to_gen} ${bad}" ||
                invalid="${invalid} ${bad}"
        done
    else
        printf "  sudo apt-get install locales\n"
        to_gen=$bad_lcs
    fi
    to_gen=${to_gen# }

    $_local pkgs=""
    for bad in ${to_gen}; do
        pkgs="${pkgs} language-pack-${bad%%_*}"
    done
    pkgs=${pkgs# }

    if [ -n "${pkgs}" ]; then
        printf "   sudo apt-get install ${pkgs# }\n"
        printf "     or\n"
        printf "   sudo locale-gen ${to_gen# }\n"
        printf "\n"
    fi
    for bad in ${invalid}; do
        printf "WARNING: '${bad}' is an invalid locale\n"
    done

    printf "To see all available language packs, run:\n"
    printf "   apt-cache search \"^language-pack-[a-z][a-z]$\"\n"
    printf "To disable this message for all users, run:\n"
    printf "   sudo touch /var/lib/cloud/instance/locale-check.skip\n"
    printf "_____________________________________________________________________\n\n"

    # only show the message once
    : > ~/.cloud-locale-test.skip 2>/dev/null || :
}

[ -f ~/.cloud-locale-test.skip -o -f /var/lib/cloud/instance/locale-check.skip ] ||
    locale 2>&1 | locale_warn

unset locale_warn
root@momentum